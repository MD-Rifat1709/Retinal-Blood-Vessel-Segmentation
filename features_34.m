clear all;
clc;
rgb = imread('D:\osama\Captures\Dataset\20 Images STARE\im0001.ppm');

redchannel=rgb(: , : , 1);
greenchannel=rgb(: , : , 2);
bluechannel=rgb(: , : , 3);
se=strel('disk',3);
tophat=imtophat(greenchannel,se);
se1=strel('disk',7);
tophat1=imtophat(greenchannel,se1);
se2=strel('disk',11);
tophat2=imtophat(greenchannel,se2);
se3=strel('disk',15);
tophat3=imtophat(greenchannel,se3);
se4=strel('disk',19);
tophat4=imtophat(greenchannel,se4);
se5=strel('disk',23);
tophat5=imtophat(greenchannel,se5);
bse=strel('disk',3);
bothat=imbothat(greenchannel,bse);
bse1=strel('disk',7);
bothat1=imbothat(greenchannel,bse1);
bse2=strel('disk',11);
bothat2=imbothat(greenchannel,bse2);
bse3=strel('disk',15);
bothat3=imbothat(greenchannel,bse3);
bse4=strel('disk',19);
bothat4=imbothat(greenchannel,bse4);
bse5=strel('disk',23);
bothat5=imbothat(greenchannel,bse5);
h1 = fspecial('gaussian', 10, 50);
h2 = fspecial('gaussian', 10, 10); 
gauss1 = conv2(greenchannel, h1, 'same');
gauss2 = conv2(greenchannel, h2, 'same');
dogImg = gauss1 - gauss2;
h3 = fspecial('gaussian', 10, 40);
h4 = fspecial('gaussian', 10, 10); 
gauss3 = conv2(greenchannel, h3, 'same');
gauss4 = conv2(greenchannel, h4, 'same');
dogImg1 = gauss3 - gauss4;
h5 = fspecial('gaussian', 10, 25);
h6 = fspecial('gaussian', 10, 5); 
gauss5 = conv2(greenchannel, h5, 'same');
gauss6 = conv2(greenchannel, h6, 'same');
dogImg2 = gauss5 - gauss6;
h7 = fspecial('gaussian', 10, 2.828);
h8 = fspecial('gaussian', 10, 2); 
gauss7 = conv2(greenchannel, h7, 'same');
gauss8 = conv2(greenchannel, h8, 'same');
dogImg3 = gauss7 - gauss8;
h9 = fspecial('gaussian', 10, 2);
h10 = fspecial('gaussian', 10, 1.414); 
gauss9 = conv2(greenchannel, h9, 'same');
gauss10 = conv2(greenchannel, h10, 'same');
dogImg4 = gauss9 - gauss10;
lab = rgb2lab(rgb);
L=lab(:,:,1);
RGB = im2double(rgb);
[R,G,B]=imsplit(RGB);
G1 = 0.06 * R + 0.63 * G + 0.27 * B;
G2 = 0.3 * R + 0.04 * G - 0.35 * B;
Gclahe = adapthisteq(greenchannel,'NumTiles',[8 8],'ClipLimit',0.01,'NBins',256,'Distribution','Uniform');
Lclahe = adapthisteq(L,'NumTiles',[8 8],'ClipLimit',0.01,'NBins',256,'Distribution','Uniform');
G1clahe = adapthisteq(G1,'NumTiles',[8 8],'ClipLimit',0.01,'NBins',256,'Distribution','Uniform');
G2clahe = adapthisteq(G2,'NumTiles',[8 8],'ClipLimit',0.01,'NBins',256,'Distribution','Uniform');
Ggabor6 = post(Gclahe,6);
Ggabor7 = post(Gclahe,7);
Ggabor8 = post(Gclahe,8);
Lgabor6 = post(Lclahe,6);
Lgabor7 = post(Lclahe,7);
Lgabor8 = post(Lclahe,8);
G1gabor6 = post(G1clahe,6);
G1gabor7 = post(G1clahe,7);
G1gabor8 = post(G1clahe,8);
G2gabor6 = post(G2clahe,6);
G2gabor7 = post(G2clahe,7);
G2gabor8 = post(G2clahe,8);
fv1 = (greenchannel);
fv1(:,:,2) = (tophat);
fv1(:,:,3) = (tophat1);
fv1(:,:,4) = (tophat2);
fv1(:,:,5) = (tophat3);
fv1(:,:,6) = (tophat4);
fv1(:,:,7) = (tophat5);
fv1(:,:,8) = (bothat);
fv1(:,:,9) = (bothat1);
fv1(:,:,10) = (bothat2);
fv1(:,:,11) = (bothat3);
fv1(:,:,12) = (bothat4);
fv1(:,:,13) = (bothat5);
fv1(:,:,14) = (dogImg);
fv1(:,:,15) = (dogImg1);
fv1(:,:,16) = (dogImg2);
fv1(:,:,17) = (dogImg3);
fv1(:,:,18) = (dogImg4);
fv1(:,:,19)= (Gclahe);
fv1(:,:,20) = (Lclahe);
fv1(:,:,21) = (G1clahe);
fv1(:,:,22) = (G2clahe);
fv1(:,:,23) = (Ggabor6);
fv1(:,:,24) = (Ggabor7);
fv1(:,:,25) = (Ggabor8);
fv1(:,:,26) = (Lgabor6);
fv1(:,:,27) = (Lgabor7);
fv1(:,:,28) = (Lgabor8);
fv1(:,:,29) = (G1gabor6);
fv1(:,:,30) = (G1gabor7);
fv1(:,:,31) = (G1gabor8);
fv1(:,:,32) = (G2gabor6);
fv1(:,:,33) = (G2gabor7);
fv1(:,:,34) = (G2gabor8);
K = kclustering(rgb,fv1);
BW = imread('D:\osama\Captures\Dataset\20 Images STARE GTruth\im0001.ah.ppm');
similarity = BF_score(BW,K);


